<p id="notice"><%= notice %></p>

<p>
  <b>Username:</b><br>
  <%= @user.username %>
</p>

<p>
  <b>Email:</b><br>
  <%= @user.email %>
</p>

<p>
  <b>User Skills:</b><br>
  <% @user.skills.each do |skill| %>
    <%= skill.name %> <br>
  <% end %>
</p>

<% if @user == current_user %>
<p>
  <b>Items Checked Out:</b>
  <table>
    <% @user.items.each do |item| %>
    <tr>
      <td>
	<%= link_to(item.name, item) %>
      </td> <td>
	<%# If the user's an Admin, it screws up therouting information here
	    We'll just cast them to a normal User temporarily %>
	<% user = @user.becomes(User) %> 
	<%= form_for([user, user.transactions.build]) do |f| %>
	<div class="action">
	  <%= f.hidden_field :item_id, {:value => item.id} %>
	  <%= f.hidden_field :class_type, {:value => "Checkin"} %>
	  <%= f.hidden_field :status, {:value => "Complete"} %>
	  <%= f.hidden_field :due_date, {:value => "Eventually"} %>
	  <%= f.submit :value=> "Check in" %>
	</div>
	<% end %>
      </td>
    </tr>
    <% end %>
  </table>
</p>

<p>
  <b>Transaction Log:</b>
  <table>
    <tr> <th> Type </th> <th> Status </th> <th> Datetime </th> </tr>
    <% @user.transactions.reverse.each do |t| %>
    <tr>
      <td>
	<%= t.class_type %>
      </td>
      <td>
	<%= t.status %>
      </td>
      <td>
	<%= t.created_at and \
	    t.created_at.getlocal.strftime("%a %b %e, %I:%M:%S %p") %>
      </td>
    </tr>
    <% end %>
  </table>
</p>
<% end %>

<% if @user == current_user %>
  <%= link_to 'Edit', edit_user_path(@user) %> |
<% end %>
<%= link_to 'Back', users_path %>

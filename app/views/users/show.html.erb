<p id="notice"><%= notice %></p>

<p>
  <b>Username:</b>
  <%= @user.username %>
</p>

<p>
  <b>Email:</b>
  <%= @user.email %>
</p>

<p>
  <b>Items Checked Out:</b>
  <table>
    <% @user.items.each do |item| %>
    <tr>
      <td>
	<%= link_to(item.name, item) %>
      </td> <td>
	<%# If the user's an Admin, it screws up therouting information here
	    We'll just cast them to a normal User temporarily %>
	<% user = @user.becomes(User) %> 
	<%= form_for([user, user.transactions.build]) do |f| %>
	<div class="action">
	  <%= f.hidden_field :item_id, {:value => item.id} %>
	  <%= f.hidden_field :class_type, {:value => "Checkin"} %>
	  <%= f.hidden_field :status, {:value => "Complete"} %>
	  <%= f.hidden_field :due_date, {:value => "Eventually"} %>
	  <%= f.submit :value=> "Check in" %>
	</div>
	<% end %>
      </td>
    </tr>
    <% end %>
  </table>
</p>

<p>
  <b>Transaction log:</b>
  <table>
    <tr> <th> Type </th> <th> Status </th> <th> Datetime </th> </tr>
    <% @user.transactions.reverse.each do |t| %>
    <tr>
      <td>
	<%= t.class_type %>
      </td>
      <td>
	<%= t.status %>
      </td>
      <td>
	<%= t.created_at and \
	    t.created_at.getlocal.strftime("%a %b %e, %I:%M:%S %p") %>
      </td>
    </tr>
    <% end %>
  </table>
</p>

<p>
  <b>Crypted password:</b>
  <%= @user.crypted_password %>
</p>

<p>
  <b>Password salt:</b>
  <%= @user.password_salt %>
</p>

<p>
  <b>Persistence token:</b>
  <%= @user.persistence_token %>
</p>


<%= link_to 'Edit', edit_user_path(@user) %> |
<%= link_to 'Back', users_path %>
